var unblock=function(e){var b=[],c=[],a=[],d={unblock:function(g){var f=c.slice(0);return function(){if(f.length<1){f=(arguments.length)?arguments:b}setTimeout(function(){b=[g.apply(d,f)];if(a.length){a.shift().apply(d,b)}},0);return d}},then:function(f){a.push(d.unblock(f));return d},after:function(f){return function(){c=Array.prototype.slice.call(arguments,0);a.push(d.unblock(f));return d}}};return d.unblock(e)};